---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  cache = FALSE
)
library(rpyANTs)
```

# rpyANTs

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/rpyANTs)](https://CRAN.R-project.org/package=rpyANTs)
[![R-CMD-check](https://github.com/dipterix/rpyANTs/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/dipterix/rpyANTs/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

`rpyANTs` is a package that ports `ANTsPy`, a `Python` implementation of `ANTs` into R using R-Python interpreter package `reticulate`. 

## Installation

The installation requires one-line extra setup

```r
# Install from CRAN
install.packages("rpyANTs")

# Install from nightly dev builder
# install.packages("rpyANTs", repos = "https://dipterix.r-universe.dev")


# set up ANTs
rpyANTs::install_ants()
```

`install_ants` creates an isolated `Python` environment managed by [`RAVE`](https://rave.wiki/). This environment does not conflict nor affect your existing Python installations.

## How to use

To load `ANTs`

```{r example1, eval = FALSE}
library(rpyANTs)

# Whether ANTs is available
ants_available()

# Load ANTs into R
ants
```

In R, we use `$` to get module functions or class members. For example:

```{r example2}
ants$add_noise_to_image
```

The following R code translates Python code into R:

```{r example3}
# >>> img = ants.image_read(ants.get_ants_data('r16'))
img <- ants$image_read(ants$get_ants_data('r16'))

# >>> noise_image1 = ants.add_noise_to_image(img, 'additivegaussian', (0.0, 1.0))
noise_image1 <- ants$add_noise_to_image(
  img, 'additivegaussian', 
  noise_parameters = tuple(0.0, 1.0)
)

# >>> noise_image2 = ants.add_noise_to_image(img, 'saltandpepper', (0.1, 0.0, 100.0))
noise_image2 <- ants$add_noise_to_image(
  img, 'saltandpepper', 
  noise_parameters = tuple(0.1, 0.0, 100.0)
)

# >>> noise_image3 = ants.add_noise_to_image(img, 'shot', 1.0)
noise_image3 <- ants$add_noise_to_image(
  img, 'shot', 
  noise_parameters = 1.0
)

# >>> noise_image4 = ants.add_noise_to_image(img, 'speckle', 1.0)
noise_image4 <- ants$add_noise_to_image(
  img, 'speckle', 
  noise_parameters = 1.0
)

```

To load imaging data into R

```{r}
orig_array <- img$numpy()
noise_array1 <- noise_image1$numpy()
noise_array2 <- noise_image2$numpy()
noise_array3 <- noise_image3$numpy()
noise_array4 <- noise_image4$numpy()

# plot via R
layout(matrix(c(1,1,2,3,1,1,4,5), nrow = 2, byrow = TRUE))
par(mar = c(0.1, 0.1, 0.1, 0.1), bg = "black", fg = "white")
pal <- grDevices::gray.colors(256, start = 0, end = 1)

image(orig_array, asp = 1, axes = FALSE, 
      col = pal, zlim = c(0, 255))
image(noise_array1, asp = 1, axes = FALSE, 
      col = pal, zlim = c(0, 255))
image(noise_array2, asp = 1, axes = FALSE, 
      col = pal, zlim = c(0, 255))
image(noise_array3, asp = 1, axes = FALSE, 
      col = pal, zlim = c(0, 255))
image(noise_array4, asp = 1, axes = FALSE, 
      col = pal, zlim = c(0, 255))
```

## Upgrade `ANTs`

To upgrade `ANTs`, first update `rpyANTs`, then upgrade `ANTsPyx`

```r
install.packages("rpyANTs")
rpymat::add_packages(packages = "antspyx", pip = TRUE)
```

## Known issues

TODO: Integers, numeric

TODO: tuple, list, ...

TODO: class operators 

TODO: type conversion

TODO: documentation

## Citation

TBA

## License

Apache-2.0
